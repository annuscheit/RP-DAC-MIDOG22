(tf-gpu) j@t:~/git/hub/MIDOG_reference_docker$ ./test.sh
Sending build context to Docker daemon  6.054GB
Step 1/31 : FROM pytorch/pytorch:1.6.0-cuda10.1-cudnn7-runtime
 ---> 6a2d656bcf94
Step 2/31 : RUN apt-get update
 ---> Using cache
 ---> 6423d7007501
Step 3/31 : RUN apt-get install -y gcc
 ---> Using cache
 ---> aa39df954bb1
Step 4/31 : RUN apt-get install ffmpeg libsm6 libxext6  -y
 ---> Using cache
 ---> 4f792520bb65
Step 5/31 : RUN apt-get update && apt-get install -y python3-opencv
 ---> Using cache
 ---> 84d6d5418795
Step 6/31 : RUN groupadd -r algorithm && useradd -m --no-log-init -r -g algorithm algorithm
 ---> Using cache
 ---> abd815c7231b
Step 7/31 : RUN mkdir -p /opt/algorithm /input /output     && chown algorithm:algorithm /opt/algorithm /input /output
 ---> Using cache
 ---> 3811cc3bbda7
Step 8/31 : USER algorithm
 ---> Using cache
 ---> e2c6897a6e68
Step 9/31 : WORKDIR /opt/algorithm
 ---> Using cache
 ---> bd045df5f580
Step 10/31 : ENV PATH="/home/algorithm/.local/bin:${PATH}"
 ---> Using cache
 ---> 1031773a6d3e
Step 11/31 : RUN python -m pip install --user -U pip
 ---> Using cache
 ---> 63739560866e
Step 12/31 : RUN pip install opencv-python
 ---> Using cache
 ---> f30bf3999eb9
Step 13/31 : COPY --chown=algorithm:algorithm requirements.txt /opt/algorithm/
 ---> Using cache
 ---> 820a1eb941b5
Step 14/31 : RUN python -m pip install --user -rrequirements.txt
 ---> Using cache
 ---> 82cefc0867b6
Step 15/31 : COPY --chown=algorithm:algorithm model/ /opt/algorithm/model/
 ---> Using cache
 ---> 90c57ad01dda
Step 16/31 : COPY --chown=algorithm:algorithm models/ /opt/algorithm/models/
 ---> Using cache
 ---> 751d4c20eea4
Step 17/31 : COPY --chown=algorithm:algorithm data/ /opt/algorithm/data/
 ---> Using cache
 ---> 9087c1e4c1fa
Step 18/31 : COPY --chown=algorithm:algorithm model_weights/ /opt/algorithm/model_weights/
 ---> Using cache
 ---> e39da853817f
Step 19/31 : COPY --chown=algorithm:algorithm yolo_models/ /opt/algorithm/yolo_models/
 ---> Using cache
 ---> 02dc64d1233a
Step 20/31 : COPY --chown=algorithm:algorithm util/ /opt/algorithm/util/
 ---> Using cache
 ---> a74a94b9c219
Step 21/31 : COPY --chown=algorithm:algorithm utils/ /opt/algorithm/utils/
 ---> Using cache
 ---> d74d86c3bd4f
Step 22/31 : COPY --chown=algorithm:algorithm process.py /opt/algorithm/
 ---> Using cache
 ---> d21b648ce76c
Step 23/31 : COPY --chown=algorithm:algorithm detection.py /opt/algorithm/
 ---> Using cache
 ---> 2b24f3400021
Step 24/31 : ENTRYPOINT python -m process $0 $@
 ---> Using cache
 ---> b6f389a9cede
Step 25/31 : LABEL nl.diagnijmegen.rse.algorithm.name=MitosisDetection
 ---> Using cache
 ---> e721e1aa1d0e
Step 26/31 : LABEL nl.diagnijmegen.rse.algorithm.hardware.cpu.count=2
 ---> Using cache
 ---> 7629ba4197ae
Step 27/31 : LABEL nl.diagnijmegen.rse.algorithm.hardware.cpu.capabilities=()
 ---> Using cache
 ---> e547421ef2d6
Step 28/31 : LABEL nl.diagnijmegen.rse.algorithm.hardware.memory=16G
 ---> Using cache
 ---> 8bf9d73d29de
Step 29/31 : LABEL nl.diagnijmegen.rse.algorithm.hardware.gpu.count=1
 ---> Using cache
 ---> 9b09a90fef4d
Step 30/31 : LABEL nl.diagnijmegen.rse.algorithm.hardware.gpu.cuda_compute_capability=6.0
 ---> Using cache
 ---> ca0d3772c707
Step 31/31 : LABEL nl.diagnijmegen.rse.algorithm.hardware.gpu.memory=8G
 ---> Using cache
 ---> ad764c0defe6
Successfully built ad764c0defe6
Successfully tagged mitosisdetection:latest
mitosisdetection-output
WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.
Overriding model.yaml anchors with anchors=3

                 from  n    params  module                                  arguments                     
  0                -1  1      3520  models.common.Conv                      [3, 32, 6, 2, 2]              
  1                -1  1     18560  models.common.Conv                      [32, 64, 3, 2]                
  2                -1  1     18816  models.common.C3                        [64, 64, 1]                   
  3                -1  1     73984  models.common.Conv                      [64, 128, 3, 2]               
  4                -1  2    115712  models.common.C3                        [128, 128, 2]                 
  5                -1  1    295424  models.common.Conv                      [128, 256, 3, 2]              
  6                -1  3    625152  models.common.C3                        [256, 256, 3]                 
  7                -1  1   1180672  models.common.Conv                      [256, 512, 3, 2]              
  8                -1  1   1182720  models.common.C3                        [512, 512, 1]                 
  9                -1  1    656896  models.common.SPPF                      [512, 512, 5]                 
 10                -1  1    131584  models.common.Conv                      [512, 256, 1, 1]              
 11                -1  1         0  torch.nn.modules.upsampling.Upsample    [None, 2, 'nearest']          
 12           [-1, 6]  1       256  models.common.ConcatT                   [256, 512, 1]                 
 13                -1  1    361984  models.common.C3                        [512, 256, 1, False]          
 14                -1  1     33024  models.common.Conv                      [256, 128, 1, 1]              
 15                -1  1         0  torch.nn.modules.upsampling.Upsample    [None, 2, 'nearest']          
 16           [-1, 4]  1       128  models.common.ConcatT                   [128, 256, 1]                 
 17                -1  1     90880  models.common.C3                        [256, 128, 1, False]          
 18                -1  1    147712  models.common.Conv                      [128, 128, 3, 2]              
 19          [-1, 14]  1       128  models.common.ConcatT                   [128, 256, 1]                 
 20                -1  1    296448  models.common.C3                        [256, 256, 1, False]          
 21                -1  1    590336  models.common.Conv                      [256, 256, 3, 2]              
 22          [-1, 10]  1       256  models.common.ConcatT                   [256, 512, 1]                 
 23                -1  1   1182720  models.common.C3                        [512, 512, 1, False]          
 24      [17, 20, 23]  1     16182  models.yolo.Detect                      [1, [[0, 1, 2, 3, 4, 5], [0, 1, 2, 3, 4, 5], [0, 1, 2, 3, 4, 5]], [128, 256, 512]]
 25                20  1         0  torch.nn.modules.upsampling.Upsample    [None, 2, 'nearest']          
 26                23  1         0  torch.nn.modules.upsampling.Upsample    [None, 4, 'nearest']          
 27      [17, 25, 26]  1         0  models.common.Concat                    [1]                           
 28                -1  1         0  models.common.GradReverse               [0.1]                         
 29                -1  1     57472  models.common.Conv                      [896, 64, 1, 1]               
 30                -1  1     32368  models.common.Conv                      [64, 56, 3, 2]                
 31                -1  1     24288  models.common.Conv                      [56, 48, 3, 2]                
 32                -1  1         0  models.common.GlobalAveragePooling      [48, 48]                      
 33                32  1       192  models.common.Linear                    [48, 4]                       
 34                32  1       288  models.common.Linear                    [48, 6]                       
 35                32  1     19344  models.common.Linear                    [48, 403]                     
 36                33  1        16  models.common.RadialPredictionLayer     [4]                           
 37                34  1        36  models.common.RadialPredictionLayer     [6]                           
 38                35  1    162409  models.common.RadialPredictionLayer     [403]                         
MYYOLOv5s0.1concatT summary: 296 layers, 7319507 parameters, 7319507 gradients, 16.8 GFLOPs

Adding AutoShape... 
WARNING: In /tmp/SimpleITK-build/ITK/Modules/IO/TIFF/src/itkTIFFImageIO.cxx, line 1261
TIFFImageIO (0x55835adfae30): ICC Profile has unsupported data type (7) for meta-data dictionary.

WARNING: In /tmp/SimpleITK-build/ITK/Modules/IO/TIFF/src/itkTIFFImageIO.cxx, line 1261
TIFFImageIO (0x55835adfae30): ICC Profile has unsupported data type (7) for meta-data dictionary.

Could not load expected_output.json using <evalutils.io.SimpleITKLoader object at 0x7fd967853b90>.
WARNING: In /tmp/SimpleITK-build/ITK/Modules/IO/TIFF/src/itkTIFFImageIO.cxx, line 1261
TIFFImageIO (0x55835ad3f870): ICC Profile has unsupported data type (7) for meta-data dictionary.

WARNING: In /tmp/SimpleITK-build/ITK/Modules/IO/TIFF/src/itkTIFFImageIO.cxx, line 1261
TIFFImageIO (0x55835ad3f870): ICC Profile has unsupported data type (7) for meta-data dictionary.

yolo_models/lrl.pt
Successfully loaded model.
In predict load image and convert to numpy
start: process_image, the img dim is: [1127 1223    4]
Warning IMG is to small, adding boarder to the image: (1127, 1223, 4)
Finish with prediction all tiles, num of overlapping preds: 52
Start merging predictions (in create_prediction_table)
ps: [[          0      483.18      164.11       0.821]
 [          0      647.13      697.68     0.65412]
 [          0      155.21      695.78     0.25563]
 [          0      21.541      1140.4     0.19058]
 [          0      483.37      164.75     0.83184]
 [          0      647.51      698.59     0.65252]
 [          0      155.43      695.46     0.29969]
 [          0      483.65       164.2     0.85941]
 [          0      648.09      697.79      0.5434]
 [          0      156.54      695.74      0.3133]
 [          0      483.97      165.08     0.84765]
 [          0      647.78      698.65     0.64772]
 [          0      156.06      696.15     0.40431]
 [          0      483.18      164.11       0.821]
 [          0      647.13      697.68     0.65412]
 [          0      155.21      695.78     0.25563]
 [          0      21.541      1140.4     0.19058]
 [          0      483.37      164.75     0.83184]
 [          0      647.51      698.59     0.65252]
 [          0      155.43      695.46     0.29969]
 [          0      483.65       164.2     0.85941]
 [          0      648.09      697.79      0.5434]
 [          0      156.54      695.74      0.3133]
 [          0      483.97      165.08     0.84765]
 [          0      647.78      698.65     0.64772]
 [          0      156.06      696.15     0.40431]
 [          0      483.18      164.11       0.821]
 [          0      647.13      697.68     0.65412]
 [          0      155.21      695.78     0.25563]
 [          0      21.541      1140.4     0.19058]
 [          0      483.37      164.75     0.83184]
 [          0      647.51      698.59     0.65252]
 [          0      155.43      695.46     0.29969]
 [          0      483.65       164.2     0.85941]
 [          0      648.09      697.79      0.5434]
 [          0      156.54      695.74      0.3133]
 [          0      483.97      165.08     0.84765]
 [          0      647.78      698.65     0.64772]
 [          0      156.06      696.15     0.40431]
 [          0      483.18      164.11       0.821]
 [          0      647.13      697.68     0.65412]
 [          0      155.21      695.78     0.25563]
 [          0      21.541      1140.4     0.19058]
 [          0      483.37      164.75     0.83184]
 [          0      647.51      698.59     0.65252]
 [          0      155.43      695.46     0.29969]
 [          0      483.65       164.2     0.85941]
 [          0      648.09      697.79      0.5434]
 [          0      156.54      695.74      0.3133]
 [          0      483.97      165.08     0.84765]
 [          0      647.78      698.65     0.64772]
 [          0      156.06      696.15     0.40431]]
52
dis [[ True False False ...  True False False]
 [False  True False ... False  True False]
 [False False  True ... False False  True]
 ...
 [ True False False ...  True False False]
 [False  True False ... False  True False]
 [False False  True ... False False  True]]
points: [[0, 4, 7, 10, 13, 17, 20, 23, 26, 30, 33, 36, 39, 43, 46, 49], [1, 5, 8, 11, 14, 18, 21, 24, 27, 31, 34, 37, 40, 44, 47, 50], [2, 6, 9, 12, 15, 19, 22, 25, 28, 32, 35, 38, 41, 45, 48, 51], [3, 16, 29, 42]]
pred_table: [[     483.54      164.54     0.84765     0.69139]
 [     647.63      698.18     0.64772     0.49705]
 [     155.81      695.78     0.40431     0.44454]
 [     21.541      1140.4     0.19058           0]]

all_predictions [[     483.54      164.54     0.84765]
 [     647.63      698.18     0.64772]
 [     155.81      695.78     0.40431]
 [     21.541      1140.4     0.19058]]
Found  4 predictions.
{'type': 'Multiple points', 'points': [{'point': [0.10942153514678402, 0.03723329354630775, 0], 'probability': 0.5650973717371622, 'name': 'mitotic figure'}, {'point': [0.14655315390605508, 0.1579925830474426, 0], 'probability': 0.43181618054707843, 'name': 'mitotic figure'}, {'point': [0.03525864216518446, 0.15745060065871597, 0], 'probability': 0.26953689257303876, 'name': 'non-mitotic figure'}, {'point': [0.0048744869548245275, 0.2580695541249699, 0], 'probability': 0.12705596288045248, 'name': 'non-mitotic figure'}], 'version': {'major': 1, 'minor': 0}}
{
    "type": "Multiple points",
    "points": [
        {
            "point": [
                0.10942153514678402,
                0.03723329354630775,
                0
            ],
            "probability": 0.5650973717371622,
            "name": "mitotic figure"
        },
        {
            "point": [
                0.14655315390605508,
                0.1579925830474426,
                0
            ],
            "probability": 0.43181618054707843,
            "name": "mitotic figure"
        },
        {
            "point": [
                0.03525864216518446,
                0.15745060065871597,
                0
            ],
            "probability": 0.26953689257303876,
            "name": "non-mitotic figure"
        },
        {
            "point": [
                0.0048744869548245275,
                0.2580695541249699,
                0
            ],
            "probability": 0.12705596288045248,
            "name": "non-mitotic figure"
        }
    ],
    "version": {
        "major": 1,
        "minor": 0
    }
}
Expected output was not found...
mitosisdetection-output
(tf-gpu) j@t:~/git/hub/MIDOG_reference_docker$
